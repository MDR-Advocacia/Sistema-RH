{% extends "base.html" %}

{% block title %}Gestão de Documentos{% endblock %}

{% block content %}
<h1 class="h2 mb-4">Gestão de Documentos</h1>

<div class="card shadow-sm">
    <div class="card-header">
        <h5 class="mb-0">Buscar Colaborador</h5>
    </div>
    <div class="card-body">
        <div class="mb-3">
            <label for="busca" class="form-label">Digite o nome ou CPF do colaborador:</label>
            <input type="text" class="form-control" id="busca" autocomplete="off">
        </div>
        <div id="resultados" class="list-group">
            </div>
    </div>
</div>

{% endblock %}

{% block scripts %}
<script>
    async function buscarColaboradores() {
        const termo = document.getElementById("busca").value.trim();
        const resultados = document.getElementById("resultados");
        resultados.innerHTML = "";

        if (termo.length < 2) return;

        const res = await fetch(`/api/buscar_funcionarios?q=${encodeURIComponent(termo)}`);
        const colaboradores = await res.json();
        
        if (colaboradores.length > 0) {
            colaboradores.forEach(colab => {
                const link = document.createElement("a");
                link.href = `/documentos/funcionario/${colab.id}`;
                link.className = 'list-group-item list-group-item-action';
                link.innerHTML = `<strong>${colab.nome}</strong><br><small class="text-muted">CPF: ${colab.cpf}</small>`;
                resultados.appendChild(link);
            });
        } else {
            resultados.innerHTML = '<p class="text-center p-3">Nenhum colaborador encontrado.</p>';
        }
    }
    
    let searchTimeout;
    document.getElementById("busca").addEventListener("keyup", () => {
        clearTimeout(searchTimeout);
        searchTimeout = setTimeout(buscarColaboradores, 300);
    });
</script>
{% endblock %}